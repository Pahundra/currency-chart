<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ì—Ä–∞—Ñ–∏–∫ –≤–∞–ª—é—Ç</title>
    <!-- Lightweight Charts –æ—Ç TradingView (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ VPN) -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #0b0e11;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 800px;
            padding: 12px;
            box-sizing: border-box;
        }
        h1 {
            font-size: 22px;
            margin: 0 0 10px 0;
            color: #f0b90b;
            text-align: center;
        }
        .currency-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .currency-btn {
            background: #1e2329;
            border: 1px solid #2b3139;
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .currency-btn.active {
            background: #f0b90b;
            color: #0b0e11;
            border-color: #f0b90b;
            font-weight: 600;
        }
        .chart-container {
            width: 100%;
            height: 450px;
            background: #1e2329;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            border: 1px solid #2b3139;
            position: relative;
        }
        #chart {
            width: 100%;
            height: 100%;
        }
        .price-info {
            background: #1e2329;
            border-radius: 12px;
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #2b3139;
        }
        .price-label {
            color: #848e9c;
            font-size: 14px;
        }
        .price-value {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-right: 12px;
        }
        .price-change {
            font-size: 15px;
            padding: 4px 10px;
            border-radius: 20px;
        }
        .positive {
            color: #0ecb81;
            background: rgba(14, 203, 129, 0.1);
        }
        .negative {
            color: #f6465d;
            background: rgba(246, 70, 93, 0.1);
        }
        .update-time {
            color: #848e9c;
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
        }
        footer {
            margin-top: 20px;
            color: #848e9c;
            font-size: 12px;
            text-align: center;
        }
        a {
            color: #f0b90b;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà –ì—Ä–∞—Ñ–∏–∫ –≤–∞–ª—é—Ç</h1>
        
        <!-- –í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã -->
        <div class="currency-selector">
            <button class="currency-btn active" data-symbol="BTCUSDT">BTC/USDT</button>
            <button class="currency-btn" data-symbol="TONUSDT">TON/USDT</button>
            <button class="currency-btn" data-symbol="USDTRUB">USDT/RUB</button>
            <button class="currency-btn" data-symbol="EURRUB">EUR/RUB</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
        <div class="chart-container">
            <div id="chart"></div>
        </div>

        <!-- –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ -->
        <div class="price-info">
            <span class="price-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</span>
            <span style="display: flex; align-items: center;">
                <span class="price-value" id="price">‚Äî</span>
                <span id="change" class="price-change">‚Äî</span>
            </span>
        </div>
        <div class="update-time" id="update-time"></div>

        <footer>
            –î–∞–Ω–Ω—ã–µ: Binance, exchangerate.host ‚Ä¢ <a href="https://t.me/ResendTm_bot" target="_blank">@ResendTm_bot</a>
        </footer>
    </div>

    <script>
        // --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
        let currentSymbol = 'BTCUSDT';
        let chart = null;
        let candleSeries = null;
        let currentPrice = 0;
        let previousClose = 0;

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–≤–µ—á–µ–π
        async function fetchCandles(symbol, interval = '1h', limit = 100) {
            let url;
            if (symbol === 'EURRUB') {
                // –î–ª—è EUR/RUB –∏—Å–ø–æ–ª—å–∑—É–µ–º exchangerate.host (–¥–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
                // –í –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ç–æ–ª—å–∫–æ daily, –ø–æ—ç—Ç–æ–º—É –ø–æ–∫–∞–∂–µ–º 30 –¥–Ω–µ–π
                const days = 30;
                const promises = [];
                for (let i = 0; i < days; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - (days - 1 - i));
                    const dateStr = date.toISOString().split('T')[0];
                    promises.push(
                        fetch(`https://api.exchangerate.host/${dateStr}?base=EUR&symbols=RUB`)
                            .then(res => res.json())
                            .then(data => ({
                                time: dateStr,
                                value: data.rates.RUB
                            }))
                    );
                }
                const dailyData = await Promise.all(promises);
                return dailyData.map(d => ({
                    time: d.time,
                    open: d.value,
                    high: d.value,
                    low: d.value,
                    close: d.value
                }));
            } else {
                // –î–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º Binance API
                let binanceSymbol = symbol;
                if (symbol === 'TONUSDT') binanceSymbol = 'TONUSDT';
                if (symbol === 'BTCUSDT') binanceSymbol = 'BTCUSDT';
                if (symbol === 'USDTRUB') binanceSymbol = 'USDTRUB';
                
                const intervalMap = {
                    '1h': '1h',
                    '4h': '4h',
                    '1d': '1d'
                };
                const binanceInterval = intervalMap[interval] || '1h';
                
                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${binanceSymbol}&interval=${binanceInterval}&limit=${limit}`);
                const data = await response.json();
                
                return data.map(candle => ({
                    time: candle[0] / 1000,
                    open: parseFloat(candle[1]),
                    high: parseFloat(candle[2]),
                    low: parseFloat(candle[3]),
                    close: parseFloat(candle[4])
                }));
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        async function fetchPrice(symbol) {
            try {
                if (symbol === 'EURRUB') {
                    const response = await fetch('https://api.exchangerate.host/latest?base=EUR&symbols=RUB');
                    const data = await response.json();
                    const price = data.rates.RUB;
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yStr = yesterday.toISOString().split('T')[0];
                    const histResp = await fetch(`https://api.exchangerate.host/${yStr}?base=EUR&symbols=RUB`);
                    const histData = await histResp.json();
                    const yestPrice = histData.rates.RUB;
                    const change = ((price - yestPrice) / yestPrice * 100).toFixed(2);
                    return { price: price.toFixed(2), change };
                } else {
                    let binanceSymbol = symbol;
                    if (symbol === 'USDTRUB') binanceSymbol = 'USDTRUB';
                    const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${binanceSymbol}`);
                    const data = await response.json();
                    const price = parseFloat(data.lastPrice);
                    const change = parseFloat(data.priceChangePercent).toFixed(2);
                    return { price: price.toFixed(2), change };
                }
            } catch (e) {
                console.error(e);
                return { price: '‚Äî', change: '‚Äî' };
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ü–µ–Ω—ã
        async function updateChart(symbol, interval = '1h') {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('price').textContent = '‚è≥';
            document.getElementById('change').textContent = '‚Äî';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
                const candles = await fetchCandles(symbol, interval, 100);
                
                // –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–∏—é
                if (!chart) {
                    chart = LightweightCharts.createChart(document.getElementById('chart'), {
                        layout: {
                            backgroundColor: '#1e2329',
                            textColor: '#d1d4dc',
                        },
                        grid: {
                            vertLines: { color: '#2b3139' },
                            horzLines: { color: '#2b3139' },
                        },
                        crosshair: {
                            mode: LightweightCharts.CrosshairMode.Normal,
                        },
                        rightPriceScale: {
                            borderColor: '#2b3139',
                        },
                        timeScale: {
                            borderColor: '#2b3139',
                            timeVisible: true,
                            secondsVisible: false,
                        },
                    });
                    
                    candleSeries = chart.addCandlestickSeries({
                        upColor: '#0ecb81',
                        downColor: '#f6465d',
                        borderVisible: false,
                        wickUpColor: '#0ecb81',
                        wickDownColor: '#f6465d',
                    });
                }
                
                candleSeries.setData(candles);
                chart.timeScale().fitContent();
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
                const priceData = await fetchPrice(symbol);
                let priceDisplay = priceData.price;
                if (priceData.price !== '‚Äî') {
                    if (symbol === 'BTCUSDT' || symbol === 'TONUSDT') {
                        priceDisplay = `$${priceData.price}`;
                    } else {
                        priceDisplay = `${priceData.price} ‚ÇΩ`;
                    }
                }
                document.getElementById('price').textContent = priceDisplay;
                
                const changeEl = document.getElementById('change');
                if (priceData.change !== '‚Äî') {
                    const change = parseFloat(priceData.change);
                    changeEl.textContent = `${priceData.change}%`;
                    changeEl.className = 'price-change ' + (change >= 0 ? 'positive' : 'negative');
                } else {
                    changeEl.textContent = '‚Äî';
                }
                
                // –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                const now = new Date();
                document.getElementById('update-time').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleTimeString()}`;
                
            } catch (e) {
                console.error(e);
                document.getElementById('price').textContent = '‚Äî';
                document.getElementById('change').textContent = '‚Äî';
            }
        }

        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ ---
        document.querySelectorAll('.currency-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentSymbol = this.dataset.symbol;
                await updateChart(currentSymbol);
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å BTC
        updateChart('BTCUSDT');

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞)
        setInterval(async () => {
            const priceData = await fetchPrice(currentSymbol);
            let priceDisplay = priceData.price;
            if (priceData.price !== '‚Äî') {
                if (currentSymbol === 'BTCUSDT' || currentSymbol === 'TONUSDT') {
                    priceDisplay = `$${priceData.price}`;
                } else {
                    priceDisplay = `${priceData.price} ‚ÇΩ`;
                }
            }
            document.getElementById('price').textContent = priceDisplay;
            
            const changeEl = document.getElementById('change');
            if (priceData.change !== '‚Äî') {
                const change = parseFloat(priceData.change);
                changeEl.textContent = `${priceData.change}%`;
                changeEl.className = 'price-change ' + (change >= 0 ? 'positive' : 'negative');
            }
            
            document.getElementById('update-time').textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()}`;
        }, 10000);
    </script>
</body>
</html>
